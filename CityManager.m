#import "CityManager.h"
#import <Foundation/Foundation.h>

@implementation CityManager

+ (instancetype)sharedInstance {
    static CityManager *instance = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        instance = [[CityManager alloc] init];
        [instance loadCityData];
    });
    return instance;
}

- (void)loadCityData {
    self.cityCodeMap = @{
        @"110000":@"北京市 朝阳区 朝阳公园",
        @"110100":@"北京市 海淀区 万柳书院",
        @"120000":@"天津市 滨海新区‌ 万科城",
        @"120100":@"天津市 和平区 华庭小区",
        @"130000":@"河北省",
        @"130100":@"石家庄市 长安区",
        @"130200":@"唐山市 路南区",
        @"130300":@"秦皇岛市 海港区",
        @"130400":@"邯郸市 丛台区",
        @"130500":@"邢台市 襄都区",
        @"130600":@"保定市 清苑区",
        @"130700":@"张家口市 桥东区",
        @"130800":@"承德市 双桥区",
        @"130900":@"沧州市 新华区",
        @"131000":@"廊坊市 广阳区",
        @"131100":@"衡水市 桃城区",
        @"140000":@"山西省",
        @"140100":@"太原市 迎泽区",
        @"140200":@"大同市 新荣区",
        @"140300":@"阳泉市 城区",
        @"140400":@"长治市 潞州区",
        @"140500":@"晋城市 城区",
        @"140600":@"朔州市 朔城区",
        @"140700":@"晋中市 榆次区",
        @"140800":@"运城市 盐湖区",
        @"140900":@"忻州市 忻府区",
        @"141000":@"临汾市 尧都区",
        @"141100":@"吕梁市 离石区",
        @"150000":@"内蒙古",
        @"150100":@"呼和浩特市 新城区",
        @"150200":@"包头市 东河区",
        @"150300":@"乌海市 海南区",
        @"150400":@"赤峰市 红山区",
        @"150500":@"通辽市 科尔沁区",
        @"150600":@"鄂尔多斯市 东胜区",
        @"150700":@"呼伦贝尔市 海拉尔区",
        @"150800":@"巴彦淖尔市 临河区",
        @"150900":@"乌兰察布市 集宁区",
        @"152200":@"兴安盟 突泉县",
        @"152500":@"锡林郭勒盟 二连浩特市",
        @"152900":@"阿拉善盟 额济纳旗",
        @"210000":@"辽宁省",
        @"210100":@"沈阳市 和平区",
        @"210200":@"大连市 中山区",
        @"210300":@"鞍山市 铁西区",
        @"210400":@"抚顺市 东洲区",
        @"210500":@"本溪市 平山区",
        @"210600":@"丹东市 元宝区",
        @"210700":@"锦州市 古塔区",
        @"210800":@"营口市 西市区",
        @"210900":@"阜新市 海州区",
        @"211000":@"辽阳市 白塔区",
        @"211100":@"盘锦市 双台子区",
        @"211200":@"铁岭市 银州区",
        @"211300":@"朝阳市 双塔区",
        @"211400":@"葫芦岛市 龙港区",
        @"220000":@"吉林省",
        @"220100":@"长春市 南关区",
        @"220200":@"吉林市 龙潭区",
        @"220300":@"四平市 铁西区",
        @"220400":@"辽源市 龙山区",
        @"220500":@"通化市 东昌区",
        @"220600":@"白山市 浑江区",
        @"220700":@"松原市 宁江区",
        @"220800":@"白城市 洮北区",
        @"222400":@"延边 延吉市",
        @"230000":@"黑龙江省",
        @"230100":@"哈尔滨市 南岗区",
        @"230200":@"齐齐哈尔市 龙沙区",
        @"230300":@"鸡西市 鸡冠区",
        @"230400":@"鹤岗市 向阳区",
        @"230500":@"双鸭山市 宝山区",
        @"230600":@"大庆市 萨尔图区",
        @"230700":@"伊春市 伊美区",
        @"230800":@"佳木斯市 向阳区",
        @"230900":@"七台河市 新兴区",
        @"231000":@"牡丹江市 东宁市",
        @"231100":@"黑河市 爱辉区",
        @"231200":@"绥化市 北林区",
        @"232700":@"大兴安岭 漠河市",
        @"310000":@"上海市 闵行区 闵行花园",
        @"310100":@"上海市 浦东新区 御沁园",
        @"320000":@"江苏省",
        @"320100":@"南京市 玄武区",
        @"320200":@"无锡市 锡山区",
        @"320300":@"徐州市 鼓楼区",
        @"320400":@"常州市 天宁区",
        @"320500":@"苏州市 虎丘区",
        @"320600":@"南通市 通州区",
        @"320700":@"连云港市 连云区",
        @"320800":@"淮安市 淮安区",
        @"320900":@"盐城市 亭湖区",
        @"321000":@"扬州市 广陵区",
        @"321100":@"镇江市 京口区",
        @"321200":@"泰州市 海陵区",
        @"321300":@"宿迁市 宿城区",
        @"330000":@"浙江省",
        @"330100":@"杭州市 上城区",
        @"330200":@"宁波市 海曙区",
        @"330300":@"温州市 鹿城区",
        @"330400":@"嘉兴市 南湖区",
        @"330500":@"湖州市 吴兴区",
        @"330600":@"绍兴市 越城区",
        @"330700":@"金华市 婺城区",
        @"330800":@"衢州市 柯城区",
        @"330900":@"舟山市 定海区",
        @"331000":@"台州市 椒江区",
        @"331100":@"丽水市 莲都区",
        @"340000":@"安徽省",
        @"340100":@"合肥市 瑶海区",
        @"340200":@"芜湖市 镜湖区",
        @"340300":@"蚌埠市 龙子湖区",
        @"340400":@"淮南市 大通区",
        @"340500":@"马鞍山市 花山区",
        @"340600":@"淮北市 杜集区",
        @"340700":@"铜陵市 铜官区",
        @"340800":@"安庆市 迎江区",
        @"341000":@"黄山市 屯溪区",
        @"341100":@"滁州市 琅琊区",
        @"341200":@"阜阳市 颍州区",
        @"341300":@"宿州市 埇桥区",
        @"341500":@"六安市 金安区",
        @"341600":@"亳州市 谯城区",
        @"341700":@"池州市 贵池区",
        @"341800":@"宣城市 宣州区",
        @"350000":@"福建省",
        @"350100":@"福州市 鼓楼区",
        @"350200":@"厦门市 思明区",
        @"350300":@"莆田市 涵江区",
        @"350400":@"三明市 三元区",
        @"350500":@"泉州市 鲤城区",
        @"350600":@"漳州市 芗城区",
        @"350700":@"南平市 延平区",
        @"350800":@"龙岩市 新罗区",
        @"350900":@"宁德市 蕉城区",
        @"360000":@"江西省",
        @"360100":@"南昌市 东湖区",
        @"360200":@"景德镇市 昌江区",
        @"360300":@"萍乡市 安源区",
        @"360400":@"九江市 浔阳区",
        @"360500":@"新余市 渝水区",
        @"360600":@"鹰潭市 月湖区",
        @"360700":@"赣州市 章贡区",
        @"360800":@"吉安市 吉州区",
        @"360900":@"宜春市 袁州区",
        @"361000":@"抚州市 临川区",
        @"361100":@"上饶市 信州区",
        @"370000":@"山东省",
        @"370100":@"济南",
        @"370200":@"青岛",
        @"370300":@"淄博",
        @"370400":@"枣庄",
        @"370500":@"东营",
        @"370600":@"烟台",
        @"370700":@"潍坊",
        @"370800":@"济宁",
        @"370900":@"泰安",
        @"371000":@"威海",
        @"371100":@"日照",
        @"371200":@"莱芜",
        @"371300":@"临沂",
        @"371400":@"德州",
        @"371500":@"聊城",
        @"371600":@"滨州",
        @"371700":@"菏泽",
        @"410000":@"河南省",
        @"410100":@"郑州",
        @"410200":@"开封",
        @"410300":@"洛阳",
        @"410400":@"平顶山",
        @"410500":@"安阳",
        @"410600":@"鹤壁",
        @"410700":@"新乡",
        @"410800":@"焦作",
        @"410900":@"濮阳",
        @"411000":@"许昌",
        @"411100":@"漯河",
        @"411200":@"三门峡",
        @"411300":@"南阳",
        @"411400":@"商丘",
        @"411500":@"信阳",
        @"411600":@"周口",
        @"411700":@"驻马店",
        @"419001":@"济源",
        @"420000":@"湖北省",
        @"420100":@"武汉",
        @"420200":@"黄石",
        @"420300":@"十堰",
        @"420500":@"宜昌",
        @"420600":@"襄阳",
        @"420700":@"鄂州",
        @"420800":@"荆门",
        @"420900":@"孝感",
        @"421000":@"荆州",
        @"421100":@"黄冈",
        @"421200":@"咸宁",
        @"421300":@"随州",
        @"422800":@"恩施",
        @"429004":@"仙桃",
        @"429005":@"潜江",
        @"429006":@"天门",
        @"429021":@"神农架",
        @"430000":@"湖南省",
        @"430100":@"长沙",
        @"430200":@"株洲",
        @"430300":@"湘潭",
        @"430400":@"衡阳",
        @"430500":@"邵阳",
        @"430600":@"岳阳",
        @"430700":@"常德",
        @"430800":@"张家界",
        @"430900":@"益阳",
        @"431000":@"郴州",
        @"431100":@"永州",
        @"431200":@"怀化",
        @"431300":@"娄底",
        @"433100":@"湘西",
        @"440000":@"广东省",
        @"440100":@"广州",
        @"440200":@"韶关",
        @"440300":@"深圳",
        @"440400":@"珠海",
        @"440500":@"汕头",
        @"440600":@"佛山",
        @"440700":@"江门",
        @"440800":@"湛江",
        @"440900":@"茂名",
        @"441200":@"肇庆",
        @"441300":@"惠州",
        @"441400":@"梅州",
        @"441500":@"汕尾",
        @"441600":@"河源",
        @"441700":@"阳江",
        @"441800":@"清远",
        @"441900":@"省直辖 东莞市",
        @"442000":@"省直辖 中山市",
        @"445100":@"潮州",
        @"445200":@"揭阳",
        @"445300":@"云浮",
        @"450000":@"广西自治区",
        @"450100":@"南宁",
        @"450200":@"柳州",
        @"450300":@"桂林",
        @"450400":@"梧州",
        @"450500":@"北海",
        @"450600":@"防城港",
        @"450700":@"钦州",
        @"450800":@"贵港",
        @"450900":@"玉林",
        @"451000":@"百色",
        @"451100":@"贺州",
        @"451200":@"河池",
        @"451300":@"来宾",
        @"451400":@"崇左",
        @"460000":@"海南",
        @"460100":@"海口",
        @"460200":@"三亚",
        @"460300":@"三沙",
        @"460400":@"儋州",
        @"469001":@"五指山",
        @"469002":@"琼海",
        @"469005":@"文昌",
        @"469006":@"万宁",
        @"469007":@"东方",
        @"469021":@"定安",
        @"469022":@"屯昌",
        @"469023":@"澄迈",
        @"469024":@"临高",
        @"469025":@"白沙",
        @"469026":@"昌江",
        @"469027":@"乐东",
        @"469028":@"陵水",
        @"469029":@"保亭",
        @"469030":@"琼中",
        @"500000":@"重庆市 渝中区 环湖雅居",
        @"500100":@"重庆市 南岸区 雅居乐园",
        @"510000":@"四川省",
        @"510100":@"成都",
        @"510300":@"自贡",
        @"510400":@"攀枝花",
        @"510500":@"泸州",
        @"510600":@"德阳",
        @"510700":@"绵阳",
        @"510800":@"广元",
        @"510900":@"遂宁",
        @"511000":@"内江",
        @"511100":@"乐山",
        @"511300":@"南充",
        @"511400":@"眉山",
        @"511500":@"宜宾",
        @"511600":@"广安",
        @"511700":@"达州",
        @"511800":@"雅安",
        @"511900":@"巴中",
        @"512000":@"资阳",
        @"513200":@"阿坝",
        @"513300":@"甘孜",
        @"513400":@"凉山",
        @"520000":@"贵州省",
        @"520100":@"贵阳",
        @"520200":@"六盘水",
        @"520300":@"遵义",
        @"520400":@"安顺",
        @"520500":@"毕节",
        @"520600":@"铜仁",
        @"522300":@"黔西南",
        @"522600":@"黔东南",
        @"522700":@"黔南",
        @"530000":@"云南",
        @"530100":@"昆明",
        @"530300":@"曲靖",
        @"530400":@"玉溪",
        @"530500":@"保山",
        @"530600":@"昭通",
        @"530700":@"丽江",
        @"530800":@"普洱",
        @"530900":@"临沧",
        @"532300":@"楚雄",
        @"532500":@"红河",
        @"532600":@"文山",
        @"532800":@"西双版纳",
        @"532900":@"大理",
        @"533100":@"德宏",
        @"533300":@"怒江",
        @"533400":@"迪庆",
        @"540000":@"西藏自治区",
        @"540100":@"拉萨",
        @"540200":@"日喀则",
        @"540300":@"昌都",
        @"540400":@"林芝",
        @"540500":@"山南",
        @"542400":@"那曲",
        @"542500":@"阿里",
        @"610000":@"陕西省",
        @"610100":@"西安",
        @"610200":@"铜川",
        @"610300":@"宝鸡",
        @"610400":@"咸阳",
        @"610500":@"渭南",
        @"610600":@"延安",
        @"610700":@"汉中",
        @"610800":@"榆林",
        @"610900":@"安康",
        @"611000":@"商洛",
        @"620000":@"甘肃省",
        @"620100":@"兰州",
        @"620200":@"嘉峪关",
        @"620300":@"金昌",
        @"620400":@"白银",
        @"620500":@"天水",
        @"620600":@"武威",
        @"620700":@"张掖",
        @"620800":@"平凉",
        @"620900":@"酒泉",
        @"621000":@"庆阳",
        @"621100":@"定西",
        @"621200":@"陇南",
        @"622900":@"临夏",
        @"623000":@"甘南",
        @"630000":@"青海省",
        @"630100":@"西宁",
        @"630200":@"海东",
        @"632200":@"海北",
        @"632300":@"黄南",
        @"632500":@"海南",
        @"632600":@"果洛",
        @"632700":@"玉树",
        @"632800":@"海西",
        @"640000":@"宁夏",
        @"640100":@"银川",
        @"640200":@"石嘴山",
        @"640300":@"吴忠",
        @"640400":@"固原",
        @"640500":@"中卫",
        @"650000":@"新疆",
        @"650100":@"乌鲁木齐",
        @"650200":@"克拉玛依",
        @"650400":@"吐鲁番",
        @"650500":@"哈密",
        @"652300":@"昌吉",
        @"652700":@"博尔塔拉",
        @"652800":@"巴音郭楞",
        @"652900":@"阿克苏",
        @"653000":@"克孜勒苏",
        @"653100":@"喀什",
        @"653200":@"和田",
        @"654000":@"伊犁",
        @"654200":@"塔城",
        @"654300":@"阿勒泰",
        @"659001":@"石河子",
        @"659002":@"阿拉尔",
        @"659003":@"图木舒克",
        @"659004":@"五家渠",
        @"659005":@"北屯",
        @"659006":@"铁门关",
        @"659007":@"双河",
        @"659008":@"可克达拉",
        @"710000":@"台湾特别行政区",
        @"710100":@"台北市 万华区",
        @"710200":@"高雄市 新兴区",
        @"710300":@"台中市 中区",
        @"710400":@"台北市 中山区",
        @"710500":@"桃园市 桃园区",
        @"710600":@"台南市 中西区",
        @"710700":@"直辖 彰化县",
        @"710800":@"直辖 屏东县",
        @"710900":@"直辖 云林县",
        @"711000":@"直辖 苗栗县",
        @"711100":@"台湾特别行政区",
        @"711200":@"直辖 嘉义县",
        @"711300":@"直辖 南投县",
        @"711400":@"直辖 宜兰县",
        @"711500":@"台湾特别行政区",
        @"711600":@"台湾特别行政区",
        @"711700":@"直辖 花莲县",
        @"711800":@"直辖 嘉义市",
        @"711900":@"直辖 台东市",
        @"712100":@"直辖 澎湖县",
        @"810000":@"香港特别行政区",
        @"810100":@"直辖 香港岛",
        @"810200":@"直辖 九龙半岛",
        @"810300":@"直辖 新界",
        @"820000":@"澳门特别行政区",
        @"820100":@"直辖 澳门半岛"
    };
}

- (NSString *)getCityNameWithCode:(NSString *)code {
    if (!code || code.length < 6) {
        return nil;
    }
    
    NSString *cityName = self.cityCodeMap[code];
    
    return cityName;
}

- (NSString *)getProvinceNameWithCode:(NSString *)code {
    if (!code || code.length < 6) {
        return nil;
    }
    NSString *provinceCode = [code substringToIndex:2];
    provinceCode = [provinceCode stringByAppendingString:@"0000"];
    NSString *provinceCodeName = self.cityCodeMap[provinceCode];
    
    return provinceCodeName;
}

+ (void)fetchLocationWithGeonameId:(NSString *)geonameId completionHandler:(void (^)(NSDictionary *locationInfo, NSError *error))completionHandler {
     NSString *username = [[NSUserDefaults standardUserDefaults] stringForKey:@"DYYYGeonamesUsername"];
    if (!username || [username length] == 0) {
        username = @"your_username"; 
    }
    NSString *urlString = [NSString stringWithFormat:@"https://secure.geonames.org/getJSON?geonameId=%@&lang=zh&username=%@", geonameId, username];
    NSURL *url = [NSURL URLWithString:urlString];
    
    NSURLSessionDataTask *task = [[NSURLSession sharedSession] dataTaskWithURL:url completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        if (error) {
            completionHandler(nil, error);
            return;
        }
        
        NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;
        
        if (httpResponse.statusCode != 200) {
            completionHandler(nil, [NSError errorWithDomain:@"com.dyyy.api" code:httpResponse.statusCode userInfo:nil]);
            return;
        }
        
        NSError *jsonError;
        NSDictionary *jsonResult = [NSJSONSerialization JSONObjectWithData:data options:0 error:&jsonError];
        
        if (jsonError) {
            completionHandler(nil, jsonError);
            return;
        }
        
        completionHandler(jsonResult, nil);
    }];
    
    [task resume];
}
@end
